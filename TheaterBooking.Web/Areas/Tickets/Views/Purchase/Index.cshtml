@using TheaterBooking.Web.Database
@using Newtonsoft.Json
@model TheaterBooking.Web.Areas.Tickets.Models.PurchaseViewModel
@{
    var showtime = (Showtime)ViewBag.Showtime;
    ViewBag.Title = $"Book {showtime.Movie.Movie_Name}";
}

<div id="data" data-client-token="@ViewBag.ClientToken"
     data-showtime-id="@Model.ShowtimeId"
     data-prices="@JsonConvert.SerializeObject(Model.Prices.ToDictionary(price => price.Key, price => price.Value.Price_Amount))"></div>

Buy tickets for: @showtime.Movie.Movie_Name
<br/>
Show time: @((showtime.Show_Date + showtime.Show_Time).ToString("f"))
<br/>

@using (Html.BeginForm("Checkout", "Purchase", FormMethod.Post, new { @class = "form-horizontal", id = "form" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "help-block" })
    @Html.HiddenFor(m => m.ShowtimeId)
    <input type="hidden" name="nonce" id="nonce">

    foreach (var price in Model.Prices)
    {
        <div class="form-group">
            <div class="control-label">@price.Value.Price_Desc (@price.Value.Price_Amount.ToString("C"))</div>
            @Html.EditorFor(m => m.Quantities[price.Key], new { @class = "form-control" })
            @Html.ValidationMessageFor(m => m.Quantities[price.Key], "", new { @class = "help-block" })
        </div>
    }
}

<div class="form-group text-right">
    <div id="paypal-button"></div>
    <div>PayPal Username: instantboxoffice@kreatious.net</div>
    <div>PayPal Password: instantboxoffice</div>
</div>
